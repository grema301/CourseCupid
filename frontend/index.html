<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Course Cupid</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cupidPink: '#C05A66',
            cupidCream: '#FAF5EF',
          },
          fontFamily: {
            script: ['"Great Vibes"', 'cursive'],
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/frontend/style.css" />
</head>
<body class="bg-cupidCream min-h-screen flex flex-col">
  <header class="flex items-center justify-between px-10 py-6">
    <a id="home-link" href="index.html" class="flex items-center gap-3">
      <img src="images/cupid_logo.png" alt="Course Cupid" class="h-8">
      <span class="text-lg font-semibold text-cupidPink">Course Cupid</span>
    </a>

    <nav class="flex gap-6 text-sm">
      <a href="index.html" class="hover:text-cupidPink font-semibold">Home</a>
      <a href="papers.html" class="hover:text-cupidPink">Papers</a>
      <a href="#" class="hover:text-cupidPink">Contact</a>
    </nav>

    <div id="auth-controls" class="flex items-center gap-4">
      <div id="auth-guest" class="flex gap-3 items-center">
        <a id="login-link" href="login.html" class="px-4 py-2 rounded-full bg-cupidPink/10 text-cupidPink hover:bg-cupidPink/20 font-medium">Log In</a>
        <a id="signup-link" href="signup.html" class="px-4 py-2 rounded-full bg-cupidPink text-white font-semibold">Register</a>
      </div>

      <div id="auth-user" class="hidden relative flex items-center gap-2">
        <div id="profile-btn" class="flex items-center gap-2 bg-white border border-cupidPink/20 rounded-full px-2 py-1 shadow-sm cursor-pointer">
          <div id="user-avatar" class="w-8 h-8 rounded-full bg-cupidPink text-white flex items-center justify-center font-semibold text-sm"></div>
          <span id="user-name" class="text-cupidPink font-medium text-sm max-w-[120px] truncate"></span>
        </div>

        <div id="profile-menu"
             class="absolute right-0 top-full mt-2 w-44 bg-white rounded-lg shadow-lg border border-cupidPink/10 z-50 overflow-hidden
                    transform transition-all duration-150 origin-top-right opacity-0 -translate-y-2 scale-95 pointer-events-none">
          <div class="py-1">
            <a href="settings.html" class="block px-4 py-2 text-sm text-cupidPink hover:bg-cupidPink/5">Settings</a>
            <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">Logout</button>
          </div>
        </div>
      </div>

      <button onclick="testCreateSession()" class="ml-4 px-3 py-1 rounded-full bg-cupidPink/10 text-cupidPink hover:bg-cupidPink/20 text-sm">Test: Create Chat Session</button>
    </div>
  </header>

  <section class="flex flex-col lg:flex-row items-center justify-between px-10 py-20">
    <div class="max-w-xl">
      <h1 class="font-script text-7xl text-cupidPink">Course Cupid</h1>
      <p class="mt-4 text-lg text-gray-800">Flirt with Options,<br>Commit to the Right Course</p>
      <div class="mt-8 flex gap-4">
          <a href="chat/default" class="inline-block rounded-full bg-cupidPink text-white px-8 py-3 font-semibold hover:bg-cupidPink/80">
            Start Chatting Now â†’
          </a>
          <a href="quiz.html" class="inline-block rounded-full bg-cupidPink/30 text-cupidPink px-8 py-3 font-semibold hover:bg-cupidPink hover:text-white transition-colors duration-300">
            Take the Quiz
          </a>
      </div>
    </div>
    <div class="mt-10 lg:mt-0 lg:w-1/2 flex justify-center">
      <img src="images/cupid_big_picture.png" alt="Cupid illustration" class="max-h-[400px]">
    </div>
  </section>

  <script src="/frontend/app.js"></script>
  <script>
    async function refreshAuthUI() {
      try {
        const res = await fetch('/api/me', { credentials: 'same-origin' });
        const d = await res.json();
        const guest = document.getElementById('auth-guest');
        const userBox = document.getElementById('auth-user');
        if (d.loggedIn) {
          guest.classList.add('hidden');
          userBox.classList.remove('hidden');
          const name = d.user?.username || 'User';
          const userNameEl = document.getElementById('user-name');
          userNameEl.textContent = name;
          userNameEl.title = name;
          const avatar = document.getElementById('user-avatar');
          avatar.textContent = name.charAt(0).toUpperCase();
        } else {
          guest.classList.remove('hidden');
          userBox.classList.add('hidden');
        }
      } catch (e) {
        console.error('Auth UI error', e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      refreshAuthUI();
      if (typeof initProfileMenu === 'function') initProfileMenu(); 

      // logout 
      document.getElementById('logout-btn')?.addEventListener('click', async () => {
        try {
          const r = await fetch('/api/logout', { method: 'POST', credentials: 'same-origin' });
          const j = await r.json();
          if (j.success) {
            await refreshAuthUI();
            window.location = '/';
          } else {
            alert('Logout failed');
          }
        } catch (err) {
          console.error(err);
        }
      });
    });
  
  

    async function testCreateSession() {
      try {
        console.log('Creating chat session...');
        
        const response = await fetch('/api/chat-sessions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        console.log('Created session:', data);
        
        if (data.session_id) {
          alert(`Success! Created session: ${data.session_id}`);
          // Later: window.location.href = `/chat/${data.session_id}`;
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to create session');
      }
    }
  
  </script>

</body>
</html>
